{"componentChunkName":"component---src-templates-blog-post-js","path":"/writings/observable-error-handling/","result":{"data":{"site":{"siteMetadata":{"title":"KWGUO Blog"}},"markdownRemark":{"id":"b81822f5-045a-5698-875e-e7e548fbb1fa","excerpt":"最近在專案上遇到一個問題，我們的程式有一個排程在固定每五分鐘執行一次，去 sync server 的資料，但是當 server 掛掉的時候，這個排程就會死掉。 這是原本的程式碼 一但執行失敗就會掛掉的原因在於錯誤在最外層的 Observer 處理，一但  出現 error ，外面的 Observer…","html":"<p>最近在專案上遇到一個問題，我們的程式有一個排程在固定每五分鐘執行一次，去 sync server 的資料，但是當 server 掛掉的時候，這個排程就會死掉。</p>\n<p>這是原本的程式碼</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token function\">ObservableInterval</span><span class=\"token punctuation\">(</span>\n  <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n  <span class=\"token number\">5L</span><span class=\"token punctuation\">,</span>\n  TimeUnit<span class=\"token punctuation\">.</span>MINUTES<span class=\"token punctuation\">,</span>\n  Schedulers<span class=\"token punctuation\">.</span><span class=\"token function\">io</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">map</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">doSync</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// This is Observable</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">.</span><span class=\"token function\">map</span> <span class=\"token punctuation\">{</span>\n  Result<span class=\"token punctuation\">.</span>Success\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">.</span><span class=\"token function\">onErrorResumeNext</span> <span class=\"token punctuation\">{</span> e<span class=\"token operator\">:</span> Throwable <span class=\"token operator\">-></span>\n  Result<span class=\"token punctuation\">.</span><span class=\"token function\">Failure</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">.</span><span class=\"token function\">subscribe</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">when</span> <span class=\"token punctuation\">(</span>it<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    Result<span class=\"token punctuation\">.</span>Success <span class=\"token operator\">-></span> SHOW_SUCCESS_MESSAGE\n    <span class=\"token keyword\">is</span> Result<span class=\"token punctuation\">.</span>Failure <span class=\"token operator\">-></span> SHOW_ERROR_MESSAGE\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>一但執行失敗就會掛掉的原因在於錯誤在最外層的 Observer 處理，一但 <code class=\"language-text\">doSync</code> 出現 error ，外面的 Observer 就會停住，要解決這個問題，就要在裡面處理好錯誤，讓錯誤不要傳到外面來。</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token function\">ObservableInterval</span><span class=\"token punctuation\">(</span>\n  <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n  <span class=\"token number\">5L</span><span class=\"token punctuation\">,</span>\n  TimeUnit<span class=\"token punctuation\">.</span>MINUTES<span class=\"token punctuation\">,</span>\n  Schedulers<span class=\"token punctuation\">.</span><span class=\"token function\">io</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">map</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">doSync</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">map</span> <span class=\"token punctuation\">{</span>\n    Result<span class=\"token punctuation\">.</span>Success\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">.</span><span class=\"token function\">onErrorResumeNext</span> <span class=\"token punctuation\">{</span> e<span class=\"token operator\">:</span> Throwable <span class=\"token operator\">-></span>\n    Result<span class=\"token punctuation\">.</span><span class=\"token function\">Failure</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">.</span><span class=\"token function\">subscribe</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">when</span> <span class=\"token punctuation\">(</span>it<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    Result<span class=\"token punctuation\">.</span>Success <span class=\"token operator\">-></span> SHOW_SUCCESS_MESSAGE\n    <span class=\"token keyword\">is</span> Result<span class=\"token punctuation\">.</span>Failure <span class=\"token operator\">-></span> SHOW_ERROR_MESSAGE\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>對於 rx 新手來說還滿容易出現的錯誤，在這邊紀錄一下。</p>","frontmatter":{"title":"Observable error handling","tags":["writing","rx"],"date":"April 17, 2021","description":"Be careful when handle observable error"}}},"pageContext":{"slug":"/observable-error-handling/","previous":{"fields":{"slug":"/android-compose-ui-lift-state-up/"},"frontmatter":{"title":"Android Compose UI lift state up","tags":["writing","android","compose ui","state management"]}},"next":{"fields":{"slug":"/react-state-manage-for-typescript/"},"frontmatter":{"title":"React State Manage for Typescript","tags":["writing","react","state","typescript"]}}}},"staticQueryHashes":["4111554205","63159454"]}