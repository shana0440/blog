{"componentChunkName":"component---src-templates-blog-post-js","path":"/writings/android-intent-flag_activity_new_task/","result":{"data":{"site":{"siteMetadata":{"title":"KWGUO Blog"}},"markdownRemark":{"id":"bedcb27e-a302-51bd-b71c-a06d7cab0b5f","excerpt":"最近在專案遇到一個對 Android Developer 滿基礎的問題吧，無奈開發 App 一直都不是我的強項（不知道為什麼現在都在開發 App），也是在這問題上折騰了許久，所以打算來了解一下 Android 的一些相關知識。 首先遇到的問題是，我們在專案中使用 url_launcher 來開啟另一個 App…","html":"<p>最近在專案遇到一個對 Android Developer 滿基礎的問題吧，無奈開發 App 一直都不是我的強項（不知道為什麼現在都在開發 App），也是在這問題上折騰了許久，所以打算來了解一下 Android 的一些相關知識。</p>\n<p>首先遇到的問題是，我們在專案中使用 <a href=\"https://pub.dev/packages/url_launcher\">url_launcher</a> 來開啟另一個 App，但在 Android 上，新開的 App 不會開啟新的 Task，而是在原本的 Task 中開啟新的 App，為了解決這個問題，先來了解一下 Android 的一些背景知識。</p>\n<h2>Activity</h2>\n<p>Activity 其實就是一個畫面，使用者可以跟他互動，而開啟 App 的時候，會透過在 AndroidManifest 的設定中，找到所謂的 <strong>主要 Activity</strong> 並啟動，也就是在 Splash Screen 後，第一個顯示的畫面。</p>\n<p>一個 App 可以擁有很多 Activity，就像是網頁在不同的畫面中切換一樣，雖然目前 Android 應該是比較流行所謂的 Single Activity Application，因為 Fragment 帶來的使用者體驗比較好，不過我寫 Android 的經驗也不多，就不在此介紹了。</p>\n<p>Activity 就像 React Component 一樣，提供許多 life cycle 的 function，我也不在此介紹了，<a href=\"https://developer.android.com/guide/components/activities?hl=zh-tw\">官方文件</a>說明的很詳細。</p>\n<h2>Task</h2>\n<p>Task 是一個 Back Stack，用來控制及收納 Activity，當從桌面開啟一個新 App 的時候，就會開啟一個新的 Task，所以我們可以在不同的 App 之間切換，並在同一個 Task 中控制 Activity 的切換，<a href=\"https://developer.android.com/guide/components/activities/tasks-and-back-stack\">官方文件</a>解釋的也是很詳細，我也不在此贅述了。</p>\n<h2>Intent</h2>\n<p>Intent 是 Android 用來向另一個<a href=\"https://developer.android.com/guide/components/fundamentals?hl=zh-tw#Components\">應用程式元件</a>要求動作的物件。</p>\n<p>在 AndroidManifest 中，我們可以設定 <code class=\"language-text\">intent-filter</code>，來控制 Activity 要接收什麼 intent，由於接受 intent 的是 activity，所以當我們接收到一個 intent，開啟一個 activity，他會在原本的 task 開啟，而不是開啟一個新的 task，這就不符合我們的預期，因為這看起來就像是同一個 App 換一個畫面而已，而不是新開了一個 App。</p>\n<p>如果要讓新開的 Activity 放到新的 Task，我們需要多加 <a href=\"https://developer.android.com/reference/android/content/Intent#FLAG_ACTIVITY_NEW_TASK\"><code class=\"language-text\">FLAG_ACTIVITY_NEW_TASK</code></a>，另外為了避免每次都新開一個新的 Task，需要使用 <a href=\"https://developer.android.com/reference/android/content/Intent#FLAG_ACTIVITY_SINGLE_TOP\"><code class=\"language-text\">FLAG_ACTIVITY_SINGLE_TOP</code></a>，這樣就會回到擁有這個 Activity 的 Task，而不是新開一個。</p>\n<h2>Deep in to url_launcher source code</h2>\n<p>接著我們來看 <code class=\"language-text\">url_launcher</code> 是怎麼使用 intent 吧，我這邊就只節錄 <code class=\"language-text\">launch</code> 的程式碼，其他的就自己去 <a href=\"https://github.com/flutter/plugins/tree/master/packages/url_launcher/url_launcher\">github</a> 看吧</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token class-name\">LaunchStatus</span> <span class=\"token function\">launch</span><span class=\"token punctuation\">(</span>\n    <span class=\"token class-name\">String</span> url<span class=\"token punctuation\">,</span>\n    <span class=\"token class-name\">Bundle</span> headersBundle<span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">boolean</span> useWebView<span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">boolean</span> enableJavaScript<span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">boolean</span> enableDomStorage<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>activity <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token class-name\">LaunchStatus</span><span class=\"token punctuation\">.</span><span class=\"token constant\">NO_ACTIVITY</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token class-name\">Intent</span> launchIntent<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>useWebView<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    launchIntent <span class=\"token operator\">=</span>\n        <span class=\"token class-name\">WebViewActivity</span><span class=\"token punctuation\">.</span><span class=\"token function\">createIntent</span><span class=\"token punctuation\">(</span>\n            activity<span class=\"token punctuation\">,</span> url<span class=\"token punctuation\">,</span> enableJavaScript<span class=\"token punctuation\">,</span> enableDomStorage<span class=\"token punctuation\">,</span> headersBundle<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    launchIntent <span class=\"token operator\">=</span>\n        <span class=\"token keyword\">new</span> <span class=\"token class-name\">Intent</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Intent</span><span class=\"token punctuation\">.</span><span class=\"token constant\">ACTION_VIEW</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">setData</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Uri</span><span class=\"token punctuation\">.</span><span class=\"token function\">parse</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">putExtra</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Browser</span><span class=\"token punctuation\">.</span><span class=\"token constant\">EXTRA_HEADERS</span><span class=\"token punctuation\">,</span> headersBundle<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  activity<span class=\"token punctuation\">.</span><span class=\"token function\">startActivity</span><span class=\"token punctuation\">(</span>launchIntent<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token class-name\">LaunchStatus</span><span class=\"token punctuation\">.</span><span class=\"token constant\">OK</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>可以看到在 <code class=\"language-text\">launchIntent</code> 這邊，並沒有指定 <code class=\"language-text\">FLAG_ACTIVITY_NEW_TASK</code>, <code class=\"language-text\">FLAG_ACTIVITY_SINGLE_TOP</code> 兩個 Flags，也就造成了我遇到的問題，如果要上這段程式碼如我預期的運作，則應該改成下面這樣。</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">    launchIntent <span class=\"token operator\">=</span>\n        <span class=\"token keyword\">new</span> <span class=\"token class-name\">Intent</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Intent</span><span class=\"token punctuation\">.</span><span class=\"token constant\">ACTION_VIEW</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">setData</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Uri</span><span class=\"token punctuation\">.</span><span class=\"token function\">parse</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">setFlags</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Intent</span><span class=\"token punctuation\">.</span><span class=\"token constant\">FLAG_ACTIVITY_NEW_TASK</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">setFlags</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Intent</span><span class=\"token punctuation\">.</span><span class=\"token constant\">FLAG_ACTIVITY_SINGLE_TOP</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">putExtra</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Browser</span><span class=\"token punctuation\">.</span><span class=\"token constant\">EXTRA_HEADERS</span><span class=\"token punctuation\">,</span> headersBundle<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>雖然最後我沒有修改這個 package，而是直接使用 <a href=\"https://pub.dev/packages/android_intent\">android_intent</a> 來解決問題。</p>\n<h2>References</h2>\n<ul>\n<li><a href=\"https://developer.android.com/guide/components/activities?hl=zh-tw\">https://developer.android.com/guide/components/activities?hl=zh-tw</a></li>\n<li><a href=\"https://developer.android.com/guide/components/activities/tasks-and-back-stack\">https://developer.android.com/guide/components/activities/tasks-and-back-stack</a></li>\n<li><a href=\"https://developer.android.com/guide/components/intents-filters?hl=zh-tw\">https://developer.android.com/guide/components/intents-filters?hl=zh-tw</a></li>\n</ul>","frontmatter":{"title":"Android Intent FLAG_ACTIVITY_NEW_TASK","tags":["writing","android","intent"],"date":"March 08, 2020","description":"A brief introduction about Android task, activity, intent"}}},"pageContext":{"slug":"/android-intent-flag_activity_new_task/","previous":{"fields":{"slug":"/flutter-inherited-widget/"},"frontmatter":{"title":"Flutter Inherited Widget","tags":["writing","flutter","state","inherited widget"]}},"next":{"fields":{"slug":"/deep-in-to-bloc/"},"frontmatter":{"title":"Deep in to BLoC","tags":["writing","flutter","state","bloc"]}}}},"staticQueryHashes":["4111554205","63159454"]}